(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-577bf595"],{"1f34":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"system-user"},[n("div",{staticClass:"pane"},[n("div",{staticClass:"dept scroller1",class:[e.dept.expand?"_expand":"_collapse"]},[n("div",{staticClass:"header"},[n("div",[e._v("组织架构")]),n("ul",[n("li",[n("el-tooltip",{attrs:{content:"刷新"}},[n("i",{staticClass:"el-icon-refresh",on:{click:function(t){return e.deptRefresh()}}})])],1),n("li",[n("el-tooltip",{attrs:{content:"拖动排序"}},[n("i",{staticClass:"el-icon-s-operation",on:{click:function(t){e.dept.isDrag=!0}}})])],1),n("li",{directives:[{name:"show",rawName:"v-show",value:e.dept.isDrag,expression:"dept.isDrag"}],staticClass:"no"},[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.deptOrder(!0)}}},[e._v("保存")]),n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.deptOrder(!1)}}},[e._v("取消")])],1)])]),n("div",{staticClass:"container",on:{contextmenu:function(t){return t.preventDefault(),e.deptCM(t)}}},[n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.dept.loading,expression:"dept.loading"}],attrs:{"node-key":"id","highlight-current":"","default-expand-all":"",data:e.dept.list,props:{label:"name"},draggable:e.dept.isDrag,"allow-drag":e.deptAllowDrag,"allow-drop":e.deptAllowDrop,"expand-on-click-node":!1},on:{"node-contextmenu":e.deptCM,"node-click":e.deptClick}})],1)]),n("div",{staticClass:"user"},[n("div",{staticClass:"header"},[n("div",{staticClass:"icon",on:{click:e.deptExpand}},[e.dept.expand?n("i",{staticClass:"el-icon-arrow-left"}):n("i",{staticClass:"el-icon-arrow-right"})]),n("span",[e._v("成员列表")])]),n("div",{staticClass:"container"},[n("cl-crud",{ref:"crud",on:{load:e.onLoad,refresh:e.onRefresh}},[n("el-row",{attrs:{type:"flex"}},[n("cl-refresh-btn"),n("cl-add-btn"),n("cl-multi-delete-btn"),n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.$service.system.user.permission.move,expression:"$service.system.user.permission.move"}],attrs:{size:"mini",type:"success",disabled:0==e.selects.ids.length},on:{click:function(t){return e.toMove()}}},[e._v("转移")]),n("cl-flex1"),n("cl-search-key")],1),n("el-row",[n("cl-table",e._g(e._b({ref:"table",scopedSlots:e._u([{key:"column-headImg",fn:function(t){var r=t.scope;return[n("cl-avatar",{style:{margin:"auto"},attrs:{shape:"square",size:"medium",src:e._f("default_avatar")(r.row.headImg)}})]}},{key:"column-status",fn:function(t){var r=t.scope;return[1==r.row.status?n("el-tag",{attrs:{size:"small",effect:"dark",type:"success"}},[e._v("启用")]):n("el-tag",{attrs:{size:"small",effect:"dark",type:"danger"}},[e._v("禁用")])]}},{key:"column-roleName",fn:function(t){var r=t.scope;return e._l(r.row.roleNameList,(function(t,r){return n("el-tag",{key:r,staticStyle:{margin:"2px"},attrs:{"disable-transitions":"",size:"small",effect:"dark"}},[e._v(e._s(t))])}))}},{key:"slot-move-btn",fn:function(t){var r=t.scope;return[n("el-button",{directives:[{name:"permission",rawName:"v-permission",value:e.$service.system.user.permission.move,expression:"$service.system.user.permission.move"}],attrs:{type:"text",size:"mini"},on:{click:function(t){return e.toMove(r.row)}}},[e._v("转移")])]}}])},"cl-table",e.table.props,!1),e.table.on))],1),n("el-row",{attrs:{type:"flex"}},[n("cl-flex1"),n("cl-pagination")],1),n("cl-upsert",e._b({ref:"upsert"},"cl-upsert",e.upsert.props,!1))],1)],1)])]),n("cl-form",{ref:"dept-upsert"}),n("cl-form",{ref:"dept-move"}),n("cl-context-menu",{ref:"context-menu"})],1)},s=[],a=(n("4160"),n("a15b"),n("d81d"),n("b0c0"),n("ac1f"),n("1276"),n("159b"),n("5530")),i=(n("96cf"),n("1da1")),o=n("8bc2"),l={data:function(){var e=this,t=this.$createElement;return{dept:{isDrag:!1,loading:!1,expand:!0,list:[]},selects:{dept:{},ids:[]},table:{props:{props:{"default-sort":{prop:"createTime",order:"descending"}},columns:[{type:"selection",align:"center",width:"60",fixed:"left"},{prop:"headImg",label:"头像",align:"center",slot:!0},{prop:"name",label:"姓名",align:"center","min-width":150},{prop:"username",label:"用户名",align:"center","min-width":150},{prop:"nickName",label:"昵称",align:"center","min-width":150},{prop:"departmentName",label:"部门名称",align:"center",emptyText:"无","min-width":150},{prop:"roleName",label:"角色","header-align":"center",emptyText:"无","min-width":200},{prop:"phone",label:"手机号码",align:"center","min-width":150,emptyText:"无"},{prop:"remark",label:"备注",align:"center","min-width":150,emptyText:"无"},{prop:"status",label:"状态",align:"center","min-width":150},{prop:"createTime",label:"创建时间",align:"center",sortable:!0,width:150},{align:"center",type:"op",layout:["slot-move-btn","edit","delete"],fixed:"right",width:"160px"}]},on:{"selection-change":function(t){e.selects.ids=t.map((function(e){return e.id}))}}},upsert:{props:{items:[{prop:"headImg",label:"头像",span:24,component:{name:"cl-upload"}},{prop:"name",label:"姓名",span:24,component:{name:"el-input",attrs:{placeholder:"请填写姓名"}},rules:{required:!0,message:"姓名不能为空"}},{prop:"nickName",label:"昵称",span:12,component:{name:"el-input",attrs:{placeholder:"请填写昵称"}},rules:{required:!0,message:"昵称不能为空"}},{prop:"username",label:"用户名",span:12,component:{name:"el-input",attrs:{placeholder:"请填写用户名"}},rules:[{required:!0,message:"用户名不能为空"}]},{prop:"password",label:"密码",span:12,hidden:":isAdd",component:{name:"el-input",props:{type:"password"},attrs:{placeholder:"请填写密码"}},rules:[{min:6,max:16,message:"密码长度在 6 到 16 个字符"}]},{prop:"roleIdList",label:"角色",span:24,value:[],component:{name:"cl-role-select",props:{props:{"multiple-limit":3}}},rules:{required:!0,message:"角色不能为空"}},{prop:"fanClubId",label:"管辖球迷会",span:24,value:-1,component:{name:"el-select",options:[{label:"cron",value:0},{label:"时间间隔",value:1}]},rules:{required:!0,message:"球迷会不能为空"}},{prop:"phone",label:"手机号码",span:12,component:{name:"el-input",attrs:{placeholder:"请填写手机号码"}}},{prop:"email",label:"邮箱",span:12,component:{name:"el-input",attrs:{placeholder:"请填写邮箱"}}},{prop:"remark",label:"备注",span:24,component:{name:"el-input",props:{type:"textarea",rows:4}}},{prop:"status",label:"状态",value:1,component:{name:"el-radio-group",options:[{label:"开启",value:1},{label:"关闭",value:0}]}},{prop:"tips",hidden:!0,component:t("div",[t("i",{class:"el-icon-warning"}),t("span",{style:"margin-left: 6px"},["新增用户默认密码为：123456"])])}],"on-submit":this.onUpsertSubmit}}}},created:function(){this.deptRefresh()},methods:{refresh:function(e){this.$refs["crud"].refresh(e)},onLoad:function(e){var t=e.ctx,n=e.app;t.service(this.$service.system.user).done(),n.refresh()},onRefresh:function(e,t){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var s,a,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return s=t.next,a=t.render,r.next=3,s(e);case 3:i=r.sent,o=i.list,o.map((function(e){e.roleName&&n.$set(e,"roleNameList",e.roleName.split(",")),e.status=Boolean(e.status)})),a(o);case 7:case"end":return r.stop()}}),r)})))()},onUpsertSubmit:function(e,t,n){var r=n.next,s=this.selects.dept.id;s||(s=this.dept.list[0].id),r(Object(a["a"])(Object(a["a"])({},t),{},{departmentId:s}))},deptRefresh:function(){var e=this;this.dept.isDrag=!1,this.dept.loading=!0,this.$service.system.dept.list().then((function(t){e.dept.list=Object(o["deepTree"])(t)})).done((function(){e.dept.loading=!1}))},deptCM:function(e,t){var n=this,r=[{label:"新增","suffix-icon":"el-icon-plus",callback:function(e,r){n.deptEdit({name:"",parentName:t.name,parentId:t.id}),r()}},{label:"编辑","suffix-icon":"el-icon-edit",callback:function(e,r){n.deptEdit(t),r()}}];t||(t=this.dept.list[0]),t.parentId&&r.push({label:"删除","suffix-icon":"el-icon-delete",callback:function(e,r){n.deptDel(t),r()}}),r.push({label:"新增成员","suffix-icon":"el-icon-user",callback:function(e,t){n.crud.append(),t()}}),this.$refs["context-menu"].open(e,{list:r})},deptExpand:function(){this.dept.expand=!this.dept.expand},deptClick:function(e){this.$refs["context-menu"].close(),this.selects.dept=e;var t=Object(o["revDeepTree"])(e.children).map((function(e){return e.id}));t.unshift(e.id),this.refresh({departmentIds:t.join(",")})},deptAllowDrag:function(e){var t=e.data;return t.parentId},deptAllowDrop:function(e,t){return t.data.parentId},deptEdit:function(e){var t=this,n=e.id?"update":"add";this.$refs["dept-upsert"].open({props:{title:"编辑部门",width:"550px","label-width":"100px"},items:[{label:"部门名称",prop:"name",value:e.name,component:{name:"el-input",attrs:{placeholder:"请填写部门名称"}},rules:{required:!0,message:"部门名称不能为空"}},{label:"上级部门",prop:"parentId",value:e.parentName||"...",component:{name:"el-input",attrs:{disabled:!0}}},{label:"排序",prop:"orderNum",value:e.orderNum||0,component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],on:{submit:function(r,s){var a=s.done,i=s.close;t.$service.system.dept[n]({id:e.id,parentId:e.parentId,name:r.name,orderNum:r.orderNum}).then((function(){t.$message.success("新增部门".concat(r.name,"成功")),i(),t.deptRefresh()}))["catch"]((function(e){t.$message.error(e),a()}))}}})},deptDel:function(e){var t=this,n=function(n){t.$service.system.dept["delete"]({ids:e.id,deleteUser:n}).then((function(){n?t.$message.success("删除成功"):t.$confirm("该部门用户已移动到部门顶级","删除成功")})).done((function(){t.deptRefresh()}))};this.$confirm("该操作会删除部门下的所有用户，是否确认？","提示",{type:"warning",confirmButtonText:"直接删除",cancelButtonText:"保留用户",distinguishCancelAndClose:!0}).then((function(){n(!0)}))["catch"]((function(e){"cancel"==e&&n(!1)}))},deptOrder:function(e){var t=this;e?this.$confirm("部门架构已发生改变，是否保存？","提示",{type:"warning"}).then((function(){var e=function e(t,r){t.forEach((function(t){t.parentId=r,n.push(t),t.children&&Object(o["isArray"])(t.children)&&e(t.children,t.id)}))},n=[];e(t.dept.list,null),t.$service.system.dept.order(n.map((function(e,t){return{id:e.id,parentId:e.parentId,orderNum:t}}))).then((function(){t.$message.success("更新排序成功")}))["catch"]((function(e){t.$message.error(e)})).done((function(){t.deptRefresh(),t.dept.isDrag=!1}))}))["catch"]((function(){})):this.deptRefresh()},toMove:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.$createElement,r=[],r=e?[e.id]:t.selects.ids,s=t,t.$refs["dept-move"].open({props:{title:"部门转移",width:"600px","label-width":"80px"},items:[{label:"选择部门",prop:"dept",component:{name:"system-user__dept-move",methods:{selectRow:function(e){this.$emit("input",e)}},render:function(){var e=arguments[0];return e("div",{style:{border:"1px solid #eee","border-radius":"3px",padding:"2px"}},[e("el-tree",{attrs:{data:s.dept.list,"node-key":"id","highlight-current":!0},props:Object(a["a"])({},{props:{label:"name"}}),on:{"node-click":this.selectRow}})])}}}],on:{submit:function(e,n){var s=n.done,a=n.close;if(!e.dept)return t.$message.warning("请选择部门"),s();var i=e.dept,o=i.name,l=i.id;t.$confirm("是否将用户转移到部门 ".concat(o," 下"),"提示",{type:"warning"}).then((function(){t.$service.system.user.move({departmentId:l,userIds:r}).then((function(){t.$message.success("转移成功"),a(),t.refresh()}))["catch"]((function(e){t.$message.error(e),s()}))}))["catch"]((function(){}))}}});case 5:case"end":return n.stop()}}),n)})))()}}},c=l,p=(n("9898"),n("c693"),n("2877")),d=Object(p["a"])(c,r,s,!1,null,"91d565a6",null);t["default"]=d.exports},"4c9c":function(e,t,n){},5026:function(e,t,n){},9898:function(e,t,n){"use strict";var r=n("5026"),s=n.n(r);s.a},c693:function(e,t,n){"use strict";var r=n("4c9c"),s=n.n(r);s.a}}]);