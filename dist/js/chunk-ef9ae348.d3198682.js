(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ef9ae348","chunk-2d2307dd","chunk-b615ea16","chunk-47b9dfc5"],{"0a21":function(e,t,n){},"137e":function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"goods-sku-edit"},[e.multiple&&e.selection.length>0?[n("div",{staticClass:"goods-sku-edit__set"},[n("el-divider",{attrs:{"content-position":"left"}},[e._v("批量设置")]),n("el-table",{attrs:{size:"mini",border:"",data:e.batch}},[e._l(e.columns,(function(t,s){return n("el-table-column",{key:s,attrs:{label:t.label,prop:t.prop,"min-width":t.width,align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[n("el-row",{attrs:{type:"flex",justify:"center"}},[n(t.component.name,e._b({tag:"component",model:{value:s.row[t.prop],callback:function(n){e.$set(s.row,t.prop,n)},expression:"scope.row[item.prop]"}},"component",t.component.props,!1))],1)]}}],null,!0)})})),n("el-table-column",{attrs:{label:"操作",align:"center",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){return e.batchUpdate(t.row)}}},[e._v("批量修改")]),n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.batchClear(t.row)}}},[e._v("清空")])]}}],null,!1,2235032277)})],2)],1)]:e._e(),e.columns.length>0?n("div",{staticClass:"goods-sku-edit__list"},[n("el-divider",{attrs:{"content-position":"left"}},[e._v("商品属性")]),n("el-table",{attrs:{size:"mini",border:"",data:e.list,"max-height":"500px"},on:{"selection-change":e.onSelectionChange}},[e.multiple?[n("el-table-column",{attrs:{fixed:"left",type:"selection",width:"60",align:"center"}}),e._l(e.spec,(function(e){return n("el-table-column",{key:e.value,attrs:{label:e.label,prop:e.value,align:"center","min-width":"80","show-overflow-tooltip":""}})}))]:e._e(),e._l(e.columns,(function(t,s){return n("el-table-column",{key:s,attrs:{label:t.label,prop:t.prop,"min-width":t.width,align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[n("el-row",{attrs:{type:"flex",justify:"center"}},[n(t.component.name,e._b({tag:"component",model:{value:s.row[t.prop],callback:function(n){e.$set(s.row,t.prop,n)},expression:"scope.row[item.prop]"}},"component",t.component.props,!1))],1)]}}],null,!0)})})),e.multiple?[n("el-table-column",{attrs:{label:"操作",align:"center",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.remove(t.$index)}}},[e._v("删除")])]}}],null,!1,1235992341)})]:e._e()],2)],1):e._e()],2)},i=[],c=(n("7db0"),n("4160"),n("d81d"),n("45fc"),n("a434"),n("159b"),n("2ef0"),{name:"goods-sku-edit",props:{multiple:Boolean,value:{type:Array,default:function(){return[]}},spec:{type:Array,default:function(){return[]}}},computed:{defaultColumn:function(){return this.$store.state.mall.defaultColumn}},data:function(){return{columns:[],list:[],batch:[],selection:[]}},watch:{value:{immediate:!0,handler:function(e){var t=this;this.list=[],this.list=e.map((function(e){var n=t.list.find((function(n){return!t.spec.map((function(e){return e.value})).some((function(t){return e[t]!==n[t]}))}));return n||e})),this.multiple||0!==e.length||(this.list=[this.create()])}},defaultColumn:{immediate:!0,handler:function(e){this.columns=e,console.log(e)}}},created:function(){this.multiple&&(this.batch=[this.create()])},methods:{create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return this.columns.forEach((function(e){t[e.prop]=e.value})),Object.assign(t,e)},remove:function(e){this.list.splice(e,1)},batchClear:function(){this.batch=[this.create()]},batchUpdate:function(){var e=this;this.selection.map((function(t){for(var n in e.batch[0])t[n]=e.batch[0][n]}))},onSelectionChange:function(e){this.selection=e},validate:function(){return 0!==this.list.length&&this.list}}}),r=c,a=(n("90f1"),n("2877")),o=Object(a["a"])(r,s,i,!1,null,"a793b724",null);t["default"]=o.exports},"144b":function(t,n,s){"use strict";s.r(n);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"goods-spec-select"},[0==e.selects.type?n("div",{staticClass:"goods-spec-select--default"},[n("goods-sku-edit",{ref:"goods-sku-edit",attrs:{spec:e.form.spec,value:e.form.sku}})],1):1==e.selects.type?n("div",{staticClass:"goods-spec-select--multiple"},[n("div",{staticClass:"goods-spec-select__upsert"},[n("goods-spec-edit",{attrs:{"create-btn":!0,value:e.form.spec},on:{create:e.onCreated}}),n("goods-sku-edit",{ref:"goods-sku-edit",attrs:{multiple:"",spec:e.form.spec,value:e.form.sku}})],1)]):e._e(),n("cl-form",{ref:"spec-tmpl"})],1)},c=[],r=(s("4de4"),s("c740"),s("4160"),s("caad"),s("d81d"),s("b0c0"),s("a9e3"),s("d3b7"),s("2532"),s("159b"),s("ddb0"),s("2ef0")),a=s.n(r),o=s("137e"),l=s("e1ab"),u=s("ed08"),d={name:"goods-spec-select",components:{GoodsSkuEdit:o["default"],GoodsSpecEdit:l["default"]},props:{type:{type:Number,default:1},data:{type:Object,default:function(){return{sku:[],spec:[]}}}},data:function(){return{form:{sku:[],spec:[]},selects:{type:1,tmpl:{label:"自定义规格"}},options:{tmpl:[]}}},watch:{type:{immediate:!0,handler:function(e){this.selects.type=e}},data:{immediate:!0,handler:"onUpdate"}},created:function(){this.refreshTmpl()},methods:{refreshTmpl:function(){var e=this;this.$service.biz.spec.template.list().then((function(t){t.unshift({name:"自定义规格"}),e.options.tmpl=t.map((function(e){return{label:e.name,value:e.data}}))}))},onCreated:function(e){if(1==this.selects.type){var t=[];Object(u["calcDescartes"])(e.map((function(e){return e.children}))).forEach((function(e){var n={};a.a.isArray(e)?e.forEach((function(e,t){n["spec_".concat(t)]=e})):n["spec_0"]=e,t.push(n)})),this.onUpdate({sku:t,spec:e})}},onUpdate:function(e){var t=this,n=e.sku,s=e.spec;if(n){var i=this.form.sku.map(u["getSpec"]);n.forEach((function(e){var n=i.findIndex((function(t){return Object(u["getSpec"])(e).includes(t)}));n>=0&&Object.assign(e,t.form.sku[n])})),this.form.sku=n}s&&(this.form.spec=s)},findSpec:function(){a.a.keys(e).filter((function(e){return e.includes("spec_")})).map((function(t){return e[t]}))},onTmplChange:function(e){var t=this;this.$confirm("切换规格模板将覆盖之前的数据，是否继续？","提示",{type:"warning"}).then((function(){t.selects.tmpl=e,e.value?t.onUpdate({sku:[],spec:JSON.parse(e.value)}):t.onUpdate(t.data)}))["catch"]((function(){return null}))},addTmpl:function(){var e=this;this.$refs["spec-tmpl"].open({props:{title:"添加规则模板"},items:[{label:"模板名称",prop:"name",component:{name:"el-input",attrs:{placeholder:"请输入模板名称"}},rules:{required:!0,message:"模板名称不能为空"}},{label:"模板规格",prop:"data",value:[],component:l["default"]}],on:{submit:function(t,n){var s=n.done,i=n.close,c=n.$refs,r=c["goods-spec-edit"].validate();r?e.$service.biz.spec.template.add({name:t.name,data:JSON.stringify(r)}).then((function(){e.$message.success("添加成功"),e.refreshTmpl(),i()}))["catch"]((function(t){e.$message.error(t),s()})):s()}}})},validate:function(){var e=this.$refs["goods-sku-edit"].validate()||[],t=this.form.spec||[];return{type:this.selects.type,spec:{spec:t,sku:e}}}}},p=d,f=(s("a1fd"),s("2877")),m=Object(f["a"])(p,i,c,!1,null,"7ded528c",null);n["default"]=m.exports},"5488d":function(e,t,n){},"5ec7":function(e,t,n){"use strict";var s=n("5488d"),i=n.n(s);i.a},"90f1":function(e,t,n){"use strict";var s=n("ed54"),i=n.n(s);i.a},a1fd:function(e,t,n){"use strict";var s=n("0a21"),i=n.n(s);i.a},e1ab:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"goods-spec-upsert"},[e._l(e.vlist,(function(t,s){return n("div",{key:s,staticClass:"goods-spec-upsert__item",class:{"is-error":t.error}},[n("div",{staticClass:"goods-spec-upsert__item-label"},[n("el-input",{attrs:{size:"mini",clearable:"",maxlength:"20",placeholder:"规格名称（颜色）"},model:{value:t.label,callback:function(n){e.$set(t,"label",n)},expression:"item.label"}})],1),n("div",{staticClass:"goods-spec-upsert__item-list"},[e._l(t.children,(function(s,i){return n("el-tag",{key:i,attrs:{size:"small",effect:"dark",closable:""},on:{close:function(n){return e.itemRemove(t,i)}}},[e._v(e._s(s))])})),n("div",{staticClass:"goods-spec-upsert__item-add"},[n("el-input",{attrs:{size:"mini",placeholder:"规格属性（白色）"},nativeOn:{keydown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.itemAdd(t)}},model:{value:t.text,callback:function(n){e.$set(t,"text",n)},expression:"item.text"}}),n("el-button",{attrs:{size:"mini",type:"success",disabled:!t.text},on:{click:function(n){return e.itemAdd(t)}}},[e._v("添加")])],1)],2),n("i",{staticClass:"el-icon-error",on:{click:function(t){return e.remove(s)}}})])})),n("div",{staticClass:"goods-spec-upsert__append"},[n("el-button",{attrs:{size:"mini"},on:{click:e.append}},[e._v("添加规格")]),e.createBtn?n("el-button",{attrs:{disabled:0==e.list.length,size:"mini",type:"success"},on:{click:e.onCreate}},[e._v("立即生成")]):e._e()],1)],2)},i=[],c=(n("caad"),n("d81d"),n("a434"),n("2532"),n("2ef0")),r=n.n(c),a={name:"goods-spec-edit",ref:"goods-spec-edit",props:["createBtn","value"],data:function(){return{list:[]}},watch:{value:{immediate:!0,handler:function(e){this.list=r.a.cloneDeep(e||[])}}},computed:{vlist:function(){return this.list.map((function(e){return e.error=null===e.error?null:!e.label||0===e.children.length,e}))}},methods:{itemAdd:function(e){e.children.includes(e.text)?this.$message.warning("属性已存在"):(e.children.push(e.text),e.text="")},itemRemove:function(e,t){e.children.splice(t,1)},remove:function(e){var t=this;this.$confirm("确认要移除该条规格码？","提示",{type:"warning"}).then((function(){t.list.splice(e,1)}))["catch"]((function(){return null}))},append:function(){this.list.push({label:"",value:"",text:"",children:[],error:null})},clear:function(){this.list=[]},validate:function(){var e=!0;return this.list.map((function(t,n){t.error=!t.label||0===t.children.length,t.error&&(e=!1)})),e?this.list.map((function(e,t){return{label:e.label,value:"spec_".concat(t),children:e.children}})):null},onCreate:function(){var e=this.validate();e?(this.$message.success("生成成功"),this.$emit("create",e)):this.$message.warning("请填写完整")}}},o=a,l=(n("5ec7"),n("2877")),u=Object(l["a"])(o,s,i,!1,null,"732c61ce",null);t["default"]=u.exports},ed08:function(e,t,n){"use strict";n.r(t),n.d(t,"calcDescartes",(function(){return s})),n.d(t,"getSpec",(function(){return i})),n.d(t,"deepMerge",(function(){return c}));n("99af"),n("4de4"),n("4160"),n("caad"),n("277d"),n("a15b"),n("d81d"),n("13d5"),n("0d03"),n("d3b7"),n("25f0"),n("2532"),n("159b"),n("ddb0");function s(e){return e.length<2?e[0]||[]:[].reduce.call(e,(function(e,t){var n=[];return e.forEach((function(e){t.forEach((function(t){var s=[].concat(Array.isArray(e)?e:[e]);s.push(t),n.push(s)}))})),n}))}function i(e){return _.keys(e).filter((function(e){return e.includes("spec_")})).map((function(t){return e[t]})).join()}function c(e,t){var n;for(n in t)e[n]=e[n]&&"[object Object]"===e[n].toString()?c(e[n],t[n]):e[n]=t[n];return e}},ed54:function(e,t,n){}}]);