(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0173ad7d"],{"32ad":function(e,t,i){"use strict";var n=i("a065"),a=i.n(n);a.a},a065:function(e,t,i){},add9:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"cl-upload-space__wrap"},[e._t("default",[e.showButton?i("el-button",{attrs:{size:"mini"},on:{click:e.open}},[e._v("点击上传")]):e._e()]),i("cl-dialog",e._b({attrs:{visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},"cl-dialog",e.props,!1),[i("div",{staticClass:"cl-upload-space"},[i("div",{staticClass:"cl-upload-space__category"},[i("div",{staticClass:"cl-upload-space__category-search"},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.editCategory()}}},[e._v("添加分类")]),i("el-input",{attrs:{placeholder:"输入关键字过滤",size:"mini"},model:{value:e.category.keyword,callback:function(t){e.$set(e.category,"keyword",t)},expression:"category.keyword"}})],1),i("div",{staticClass:"cl-upload-space__category-list"},[i("ul",e._l(e.categoryList,(function(t,n){return i("li",{key:n,class:{"is-active":t.id==e.category.current.id},on:{click:function(i){return e.selectCategory(t)},contextmenu:function(i){return i.stopPropagation(),i.preventDefault(),e.openCategoryContextMenu(i,t)}}},[e._v(" "+e._s(t.name)+" ")])})),0)])]),i("div",{staticClass:"cl-upload-space__content"},[i("div",{staticClass:"cl-upload-space__opbar"},[i("el-button",{attrs:{type:"success",size:"mini",disabled:0===e.selection.length},on:{click:function(t){return e.confirmFile()}}},[e._v("使用选中文件")]),i("el-button",{attrs:{type:"danger",size:"mini",disabled:0===e.selection.length,loading:e.file.loading.delete},on:{click:function(t){return e.deleteFile()}}},[e._v("删除选中文件")]),i("el-upload",e._b({style:{"margin-left":"10px"}},"el-upload",e.upload.props,!1),[i("el-button",{attrs:{type:"primary",size:"mini",loading:e.file.loading.upload}},[e._v("上传文件")])],1)],1),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.file.loading.refresh,expression:"file.loading.refresh"}],staticClass:"cl-upload-space__file",attrs:{"element-loading-text":"拼命加载中"}},[e.file.list.length>0?i("el-row",e._l(e.file.list,(function(e,t){return i("el-col",{key:t,attrs:{span:6}},[i("file-item",{attrs:{value:e}})],1)})),1):i("div",{staticClass:"cl-upload-space__file-empty"},[i("el-upload",e._b({attrs:{drag:""}},"el-upload",e.upload.props,!1),[i("i",{staticClass:"el-icon-upload"}),i("div",{staticClass:"el-upload__text"},[e._v(" 将文件拖到此处，或"),i("em",[e._v("点击上传")])])])],1)],1),i("el-pagination",{attrs:{background:"","page-size":e.file.pagination.size,"current-page":e.file.pagination.page,total:e.file.pagination.total},on:{"current-change":e.onCurrentChange}})],1)])]),i("cl-context-menu",{ref:"context-menu"}),i("cl-form",{ref:"form-category"})],2)},a=[],o=(i("4de4"),i("caad"),i("a15b"),i("d81d"),i("b0c0"),i("a9e3"),i("ac1f"),i("2532"),i("1276"),i("5530")),s=i("2f62"),l=i("2ef0"),c=i.n(l),r={componentName:"UploadSpace",props:{limit:{type:Number,default:8},accept:{type:String,default:"*"},showButton:{type:Boolean,default:!0}},components:{fileItem:{props:{value:Object},computed:{parent:function(){var e=this;while("UploadSpace"!=e.$options.componentName)e=e.$parent;return e}},methods:{onSelect:function(){this.parent.selectFile(this.value)},onContextMenu:function(e){this.parent.openFileContextMenu(e,this.value),e.stopPropagation(),e.preventDefault()}},render:function(){var e=arguments[0];if(!this.value)return null;var t=null,i=this.value,n=i.url,a=i.type,o=i.selected,s=(a||"").split("/")[0];switch(s){case"image":t=e("el-image",{attrs:{fit:"cover",src:n,lazy:!0}});break;case"video":t=e("video",{attrs:{controls:!0,src:n},style:{"max-height":"100%","max-width":"100%"}});break;default:t=e("span",[n]);break}return e("div",{class:["cl-upload-space__file-item","is-".concat(s)],on:{click:this.onSelect,contextmenu:this.onContextMenu}},[t,e("div",{class:"cl-upload-space__file-size"}),o&&e("div",{class:"cl-upload-space__file-mask"},[e("i",{class:"el-icon-success"})])])}}},data:function(){return{visible:!1,props:{title:"文件空间",props:{"close-on-click-modal":!1,"append-to-body":!0,width:"1000px"}},upload:{props:{action:"",accept:this.accept,multiple:!0,headers:{Authorization:this.token},"show-file-list":!1,"http-request":this.httpRequest}},category:{list:[],current:{},keyword:""},file:{list:[],pagination:{page:1,size:12,total:0},loading:{refresh:!1,delete:!1,upload:!1}}}},computed:Object(o["a"])(Object(o["a"])({},Object(s["b"])(["token"])),{},{categoryList:function(){var e=this;return this.category.list.filter((function(t){return t.name.includes(e.category.keyword)}))},selection:function(){return this.file.list.filter((function(e){return e.selected}))}}),filters:{file_name:function(e){return c.a.last(e.split("."))}},created:function(){var e=this;this.refreshCategory().then((function(){e.category.current=e.category.list[0],e.refreshFile()}))},methods:{open:function(){this.visible=!0},close:function(){var e=this;this.visible=!1,this.$nextTick((function(){e.file.list.map((function(t){e.$set(t,"selected",!1)}))}))},httpRequest:function(e){var t=this;this.file.loading.upload=!0,this.$service.common.ossUpload(e.file).then((function(i){t.$service.space.info.add({url:i,type:e.file.type,classifyId:t.category.current.id}).then((function(){t.refreshFile()}))["catch"]((function(e){t.$message.error(e)})).done((function(){t.file.loading.upload=!1}))}))},refreshFile:function(e){var t=this;this.file.loading.refresh=!0,this.$service.space.info.page(Object(o["a"])(Object(o["a"])(Object(o["a"])({},this.file.pagination),e),{},{classifyId:this.category.current.id})).then((function(e){t.file.pagination=e.pagination,t.file.list=e.list})).done((function(){t.file.loading.refresh=!1}))},refreshCategory:function(){var e=this;return this.$service.space.type.list().then((function(t){t.unshift({name:"全部文件",id:null}),e.category.list=t}))},editCategory:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$refs["form-category"].open({props:{title:"添加分类",width:"400px"},items:[{label:"分类名称",prop:"name",value:t.name,component:{name:"el-input",attrs:{placeholder:"请填写分类名称"}},rules:{required:!0,message:"分类名称不能为空"}}],on:{submit:function(i,n){var a=n.done,s=n.close,l=null;l=t.id?e.$service.space.type.update(Object(o["a"])(Object(o["a"])({},i),{},{id:t.id})):e.$service.space.type.add(i),l.then((function(){e.refreshCategory(),s()}))["catch"]((function(t){e.$message.error(t),a()}))}}})},selectCategory:function(e){this.category.current=e,this.file.pagination={page:1,size:12,total:0},this.refreshFile({classifyId:e.id})},openCategoryContextMenu:function(e,t){var i=this,n=t.id,a=t.name;if(!n)return!1;this.$refs["context-menu"].open(e,{list:[{label:"编辑","suffix-icon":"el-icon-edit",callback:function(e,t){t(),i.editCategory({id:n,name:a})}},{label:"删除","suffix-icon":"el-icon-delete",callback:function(e,t){t(),i.$confirm("此操作将删除【".concat(a,"】下的文件, 是否继续?"),"提示",{type:"warning"}).then((function(){i.$service.space.type["delete"]({ids:n}).then((function(){i.$message.success("删除成功"),i.refreshCategory()}))["catch"]((function(e){console.error(e),i.$message.error(e)}))}))["catch"]((function(){}))}}]})},openFileContextMenu:function(e,t){var i=this;this.$refs["context-menu"].open(e,{list:[{label:t.selected?"取消选中":"选中","suffix-icon":t.selected?"el-icon-close":"el-icon-check",callback:function(e,n){i.selectFile(t),n()}},{label:"删除","suffix-icon":"el-icon-delete",callback:function(e,n){i.deleteFile(t),n()}}]})},confirmFile:function(){var e=this,t=this.selection.filter((function(t,i){return i<e.limit})).map((function(e){return e.url})).join(",");this.$emit("input",t),this.$emit("confirm",t),this.close()},selectFile:function(e){this.$set(e,"selected",!e.selected)},deleteFile:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];c.a.isEmpty(i)&&(i=this.selection),this.$confirm("此操作将删除文件, 是否继续?","提示",{type:"warning"}).then((function(){e.file.loading["delete"]=!0,e.$service.space.info["delete"]({ids:i.map((function(e){return e.id})).join(",")}).then((function(){e.$message.success("删除成功"),e.refreshFile()}))["catch"]((function(t){e.$message.error(t)})).done((function(){e.file.loading["delete"]=!1}))}))["catch"]((function(){}))},onCurrentChange:function(e){this.refreshFile({page:e})}}},u=r,p=(i("32ad"),i("2877")),f=Object(p["a"])(u,n,a,!1,null,"56e7f505",null);t["default"]=f.exports}}]);