(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0eb80bee","chunk-2d2307dd","chunk-ef9ae348","chunk-b615ea16","chunk-47b9dfc5"],{"0a21":function(e,t,n){},"137e":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"goods-sku-edit"},[e.multiple&&e.selection.length>0?[n("div",{staticClass:"goods-sku-edit__set"},[n("el-divider",{attrs:{"content-position":"left"}},[e._v("批量设置")]),n("el-table",{attrs:{size:"mini",border:"",data:e.batch}},[e._l(e.columns,(function(t,o){return n("el-table-column",{key:o,attrs:{label:t.label,prop:t.prop,"min-width":t.width,align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[n("el-row",{attrs:{type:"flex",justify:"center"}},[n(t.component.name,e._b({tag:"component",model:{value:o.row[t.prop],callback:function(n){e.$set(o.row,t.prop,n)},expression:"scope.row[item.prop]"}},"component",t.component.props,!1))],1)]}}],null,!0)})})),n("el-table-column",{attrs:{label:"操作",align:"center",width:"200",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){return e.batchUpdate(t.row)}}},[e._v("批量修改")]),n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.batchClear(t.row)}}},[e._v("清空")])]}}],null,!1,2235032277)})],2)],1)]:e._e(),e.columns.length>0?n("div",{staticClass:"goods-sku-edit__list"},[n("el-divider",{attrs:{"content-position":"left"}},[e._v("商品属性")]),n("el-table",{attrs:{size:"mini",border:"",data:e.list,"max-height":"500px"},on:{"selection-change":e.onSelectionChange}},[e.multiple?[n("el-table-column",{attrs:{fixed:"left",type:"selection",width:"60",align:"center"}}),e._l(e.spec,(function(e){return n("el-table-column",{key:e.value,attrs:{label:e.label,prop:e.value,align:"center","min-width":"80","show-overflow-tooltip":""}})}))]:e._e(),e._l(e.columns,(function(t,o){return n("el-table-column",{key:o,attrs:{label:t.label,prop:t.prop,"min-width":t.width,align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[n("el-row",{attrs:{type:"flex",justify:"center"}},[n(t.component.name,e._b({tag:"component",model:{value:o.row[t.prop],callback:function(n){e.$set(o.row,t.prop,n)},expression:"scope.row[item.prop]"}},"component",t.component.props,!1))],1)]}}],null,!0)})})),e.multiple?[n("el-table-column",{attrs:{label:"操作",align:"center",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.remove(t.$index)}}},[e._v("删除")])]}}],null,!1,1235992341)})]:e._e()],2)],1):e._e()],2)},r=[],i=(n("7db0"),n("4160"),n("d81d"),n("45fc"),n("a434"),n("159b"),n("2ef0"),{name:"goods-sku-edit",props:{multiple:Boolean,value:{type:Array,default:function(){return[]}},spec:{type:Array,default:function(){return[]}}},computed:{defaultColumn:function(){return this.$store.state.mall.defaultColumn}},data:function(){return{columns:[],list:[],batch:[],selection:[]}},watch:{value:{immediate:!0,handler:function(e){var t=this;this.list=[],this.list=e.map((function(e){var n=t.list.find((function(n){return!t.spec.map((function(e){return e.value})).some((function(t){return e[t]!==n[t]}))}));return n||e})),this.multiple||0!==e.length||(this.list=[this.create()])}},defaultColumn:{immediate:!0,handler:function(e){this.columns=e,console.log(e)}}},created:function(){this.multiple&&(this.batch=[this.create()])},methods:{create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return this.columns.forEach((function(e){t[e.prop]=e.value})),Object.assign(t,e)},remove:function(e){this.list.splice(e,1)},batchClear:function(){this.batch=[this.create()]},batchUpdate:function(){var e=this;this.selection.map((function(t){for(var n in e.batch[0])t[n]=e.batch[0][n]}))},onSelectionChange:function(e){this.selection=e},validate:function(){return 0!==this.list.length&&this.list}}}),s=i,l=(n("90f1"),n("2877")),a=Object(l["a"])(s,o,r,!1,null,"a793b724",null);t["default"]=a.exports},"144b":function(t,n,o){"use strict";o.r(n);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"goods-spec-select"},[0==e.selects.type?n("div",{staticClass:"goods-spec-select--default"},[n("goods-sku-edit",{ref:"goods-sku-edit",attrs:{spec:e.form.spec,value:e.form.sku}})],1):1==e.selects.type?n("div",{staticClass:"goods-spec-select--multiple"},[n("div",{staticClass:"goods-spec-select__upsert"},[n("goods-spec-edit",{attrs:{"create-btn":!0,value:e.form.spec},on:{create:e.onCreated}}),n("goods-sku-edit",{ref:"goods-sku-edit",attrs:{multiple:"",spec:e.form.spec,value:e.form.sku}})],1)]):e._e(),n("cl-form",{ref:"spec-tmpl"})],1)},i=[],s=(o("4de4"),o("c740"),o("4160"),o("caad"),o("d81d"),o("b0c0"),o("a9e3"),o("d3b7"),o("2532"),o("159b"),o("ddb0"),o("2ef0")),l=o.n(s),a=o("137e"),c=o("e1ab"),u=o("ed08"),m={name:"goods-spec-select",components:{GoodsSkuEdit:a["default"],GoodsSpecEdit:c["default"]},props:{type:{type:Number,default:1},data:{type:Object,default:function(){return{sku:[],spec:[]}}}},data:function(){return{form:{sku:[],spec:[]},selects:{type:1,tmpl:{label:"自定义规格"}},options:{tmpl:[]}}},watch:{type:{immediate:!0,handler:function(e){this.selects.type=e}},data:{immediate:!0,handler:"onUpdate"}},created:function(){this.refreshTmpl()},methods:{refreshTmpl:function(){var e=this;this.$service.biz.spec.template.list().then((function(t){t.unshift({name:"自定义规格"}),e.options.tmpl=t.map((function(e){return{label:e.name,value:e.data}}))}))},onCreated:function(e){if(1==this.selects.type){var t=[];Object(u["calcDescartes"])(e.map((function(e){return e.children}))).forEach((function(e){var n={};l.a.isArray(e)?e.forEach((function(e,t){n["spec_".concat(t)]=e})):n["spec_0"]=e,t.push(n)})),this.onUpdate({sku:t,spec:e})}},onUpdate:function(e){var t=this,n=e.sku,o=e.spec;if(n){var r=this.form.sku.map(u["getSpec"]);n.forEach((function(e){var n=r.findIndex((function(t){return Object(u["getSpec"])(e).includes(t)}));n>=0&&Object.assign(e,t.form.sku[n])})),this.form.sku=n}o&&(this.form.spec=o)},findSpec:function(){l.a.keys(e).filter((function(e){return e.includes("spec_")})).map((function(t){return e[t]}))},onTmplChange:function(e){var t=this;this.$confirm("切换规格模板将覆盖之前的数据，是否继续？","提示",{type:"warning"}).then((function(){t.selects.tmpl=e,e.value?t.onUpdate({sku:[],spec:JSON.parse(e.value)}):t.onUpdate(t.data)}))["catch"]((function(){return null}))},addTmpl:function(){var e=this;this.$refs["spec-tmpl"].open({props:{title:"添加规则模板"},items:[{label:"模板名称",prop:"name",component:{name:"el-input",attrs:{placeholder:"请输入模板名称"}},rules:{required:!0,message:"模板名称不能为空"}},{label:"模板规格",prop:"data",value:[],component:c["default"]}],on:{submit:function(t,n){var o=n.done,r=n.close,i=n.$refs,s=i["goods-spec-edit"].validate();s?e.$service.biz.spec.template.add({name:t.name,data:JSON.stringify(s)}).then((function(){e.$message.success("添加成功"),e.refreshTmpl(),r()}))["catch"]((function(t){e.$message.error(t),o()})):o()}}})},validate:function(){var e=this.$refs["goods-sku-edit"].validate()||[],t=this.form.spec||[];return{type:this.selects.type,spec:{spec:t,sku:e}}}}},d=m,p=(o("a1fd"),o("2877")),f=Object(p["a"])(d,r,i,!1,null,"7ded528c",null);n["default"]=f.exports},"5488d":function(e,t,n){},"5ec7":function(e,t,n){"use strict";var o=n("5488d"),r=n.n(o);r.a},"69ea":function(e,t,n){},"90f1":function(e,t,n){"use strict";var o=n("ed54"),r=n.n(o);r.a},a1fd:function(e,t,n){"use strict";var o=n("0a21"),r=n.n(o);r.a},a762:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"商品名称",prop:"commodityName"}},[n("el-input",{model:{value:e.ruleForm.commodityName,callback:function(t){e.$set(e.ruleForm,"commodityName",t)},expression:"ruleForm.commodityName"}})],1),n("el-form-item",{attrs:{label:"商品封面",prop:"commodityCover"}},[n("cl-upload",{staticClass:"avatar-uploader",attrs:{value:e.ruleForm.commodityCover,size:[150,150],icon:"el-icon-plus",accept:"*","on-success":e.commodityCoverUploadSuccess}})],1),n("el-form-item",{attrs:{label:"商品图片",prop:""}},[n("cl-upload",{staticClass:"avatar-uploader",attrs:{multiple:"",limit:5,listType:"picture-card",filePath:e.ruleForm.commodityBannerImg,size:[150,150],icon:"el-icon-plus",accept:"*","on-success":e.commodityBannerImgUploadSuccess}})],1),n("el-form-item",{attrs:{label:"兑换方式"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ruleForm.changeMethod,callback:function(t){e.$set(e.ruleForm,"changeMethod",t)},expression:"ruleForm.changeMethod"}},[n("el-option",{attrs:{label:"纯积分兑换",value:1}})],1)],1),n("el-form-item",{attrs:{label:"规格",prop:"specification"}},[n("goods-spec-select",{ref:"goods-spec-select",attrs:{type:e.ruleForm.specType}})],1),n("el-form-item",{attrs:{label:"商品详情",prop:"desc"}},[n("cl-editor-quill",{attrs:{height:"300"},model:{value:e.ruleForm.detailImage,callback:function(t){e.$set(e.ruleForm,"detailImage",t)},expression:"ruleForm.detailImage"}})],1),n("el-form-item",{attrs:{label:"商品排序"}},[n("el-input-number",{model:{value:e.ruleForm.commodityOrder,callback:function(t){e.$set(e.ruleForm,"commodityOrder",t)},expression:"ruleForm.commodityOrder"}})],1),n("el-form-item",{attrs:{label:"状态"}},[n("el-switch",{attrs:{"active-text":"上架","inactive-text":"下架"},model:{value:e.ruleForm.commodityStatus,callback:function(t){e.$set(e.ruleForm,"commodityStatus",t)},expression:"ruleForm.commodityStatus"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("立即创建")]),n("el-button",{on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)},r=[],i=(n("99af"),n("4160"),n("d81d"),n("159b"),n("5530")),s=(n("96cf"),n("1da1")),l=n("144b"),a=[{label:"图片",prop:"pic",width:80,value:"",component:{name:"cl-upload",props:{size:46,text:""}}},{label:"名称",prop:"name",value:"",width:150,component:{name:"el-input",props:{placeholder:"请输入名称"}}},{label:"积分消耗",prop:"scoreCost",value:0,width:150,component:{name:"el-input-number",props:{step:1,min:0,max:1e6,precision:0}}},{label:"库存",prop:"stock",value:100,width:150,component:{name:"el-input-number",props:{step:1,min:0,max:1e6,precision:0}}}],c={components:{GoodsSpecSelect:l["default"]},data:function(){return{defaultColumn:[],ruleForm:{changeMethod:1,commodityName:"",commodityCover:"",commodityBannerImg:[],deliveryMethod:0,freeShippingMethod:0,freeShippingMethodShow:!1,commodityOrder:1,detailImage:"",commodityStatus:0,scopeReward:1},rules:{commodityName:[{required:!0,message:"请输入商品名称",trigger:"blur"}],commodityCover:[{required:!0,message:"请上传商品封面",trigger:"blur"}],commodityBannerImg:[{required:!0,message:"请上传商品主图",trigger:"blur"}],detailImage:[{required:!0,message:"请编辑商品详情",trigger:"blur"}],commodityOrderg:[{required:!0,message:"请填写商品排序",trigger:"blur"}],commodityStatus:[{required:!0,message:"",trigger:"blur"}]}}},watch:{ruleForm:{handler:function(e,t){},deep:!0}},created:function(){this.$store.dispatch("setDefaultcolumn",a)},methods:{salePromotionMethodChange:function(e){var t=new Array;this.ruleForm.salePromotionMethod.forEach((function(e,n,o){console.log(e),0==e&&t.push({label:"促销价格",prop:"salePromotionPrice",value:0,width:150,component:{name:"el-input-number",props:{step:1,min:.1,max:1e6,precision:2}}}),1==e&&t.push({label:"积分抵扣",prop:"scoreCost",value:0,width:150,component:{name:"el-input-number",props:{step:1,min:0,max:1e6,precision:0}}})})),console.log(t);var n=a.concat(t);this.$store.dispatch("setDefaultcolumn",n),console.log(this.defaultColumn)},commodityCoverUploadSuccess:function(e,t,n){console.log(e,n),e&&(this.ruleForm.commodityCover=e)},commodityCoverBeforeUpload:function(){},commodityBannerImgUploadSuccess:function(e,t,n){console.log(e,n),e&&(this.ruleForm.commodityBannerImg=n.map((function(e){return e.url}))),console.log(this.ruleForm.commodityBannerImg)},submitForm:function(e){var t=this;this.$refs[e].validate(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){var o,r,s,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=t.$refs["goods-spec-select"].validate(),r=o.type,s=o.spec,t.ruleForm.specificationType=r,t.ruleForm.specification=JSON.stringify(s),!n){e.next=12;break}return l=Object(i["a"])({},t.ruleForm),l.salePromotionMethod=t.salePromotionMethod,console.log(JSON.stringify(l)),e.next=9,t.$service.app.commodity.score.add(l);case 9:t.$alert("商品添加成功！","提示",{confirmButtonText:"确定",callback:function(e){}}),e.next=14;break;case 12:return console.log("error submit!!"),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},resetForm:function(e){console.log("重置表单"),this.$refs[e].resetFields()}}},u=c,m=(n("b67e"),n("2877")),d=Object(m["a"])(u,o,r,!1,null,"5c86fb56",null);t["default"]=d.exports},b67e:function(e,t,n){"use strict";var o=n("69ea"),r=n.n(o);r.a},e1ab:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"goods-spec-upsert"},[e._l(e.vlist,(function(t,o){return n("div",{key:o,staticClass:"goods-spec-upsert__item",class:{"is-error":t.error}},[n("div",{staticClass:"goods-spec-upsert__item-label"},[n("el-input",{attrs:{size:"mini",clearable:"",maxlength:"20",placeholder:"规格名称（颜色）"},model:{value:t.label,callback:function(n){e.$set(t,"label",n)},expression:"item.label"}})],1),n("div",{staticClass:"goods-spec-upsert__item-list"},[e._l(t.children,(function(o,r){return n("el-tag",{key:r,attrs:{size:"small",effect:"dark",closable:""},on:{close:function(n){return e.itemRemove(t,r)}}},[e._v(e._s(o))])})),n("div",{staticClass:"goods-spec-upsert__item-add"},[n("el-input",{attrs:{size:"mini",placeholder:"规格属性（白色）"},nativeOn:{keydown:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"enter",13,n.key,"Enter")?null:e.itemAdd(t)}},model:{value:t.text,callback:function(n){e.$set(t,"text",n)},expression:"item.text"}}),n("el-button",{attrs:{size:"mini",type:"success",disabled:!t.text},on:{click:function(n){return e.itemAdd(t)}}},[e._v("添加")])],1)],2),n("i",{staticClass:"el-icon-error",on:{click:function(t){return e.remove(o)}}})])})),n("div",{staticClass:"goods-spec-upsert__append"},[n("el-button",{attrs:{size:"mini"},on:{click:e.append}},[e._v("添加规格")]),e.createBtn?n("el-button",{attrs:{disabled:0==e.list.length,size:"mini",type:"success"},on:{click:e.onCreate}},[e._v("立即生成")]):e._e()],1)],2)},r=[],i=(n("caad"),n("d81d"),n("a434"),n("2532"),n("2ef0")),s=n.n(i),l={name:"goods-spec-edit",ref:"goods-spec-edit",props:["createBtn","value"],data:function(){return{list:[]}},watch:{value:{immediate:!0,handler:function(e){this.list=s.a.cloneDeep(e||[])}}},computed:{vlist:function(){return this.list.map((function(e){return e.error=null===e.error?null:!e.label||0===e.children.length,e}))}},methods:{itemAdd:function(e){e.children.includes(e.text)?this.$message.warning("属性已存在"):(e.children.push(e.text),e.text="")},itemRemove:function(e,t){e.children.splice(t,1)},remove:function(e){var t=this;this.$confirm("确认要移除该条规格码？","提示",{type:"warning"}).then((function(){t.list.splice(e,1)}))["catch"]((function(){return null}))},append:function(){this.list.push({label:"",value:"",text:"",children:[],error:null})},clear:function(){this.list=[]},validate:function(){var e=!0;return this.list.map((function(t,n){t.error=!t.label||0===t.children.length,t.error&&(e=!1)})),e?this.list.map((function(e,t){return{label:e.label,value:"spec_".concat(t),children:e.children}})):null},onCreate:function(){var e=this.validate();e?(this.$message.success("生成成功"),this.$emit("create",e)):this.$message.warning("请填写完整")}}},a=l,c=(n("5ec7"),n("2877")),u=Object(c["a"])(a,o,r,!1,null,"732c61ce",null);t["default"]=u.exports},ed08:function(e,t,n){"use strict";n.r(t),n.d(t,"calcDescartes",(function(){return o})),n.d(t,"getSpec",(function(){return r})),n.d(t,"deepMerge",(function(){return i}));n("99af"),n("4de4"),n("4160"),n("caad"),n("277d"),n("a15b"),n("d81d"),n("13d5"),n("0d03"),n("d3b7"),n("25f0"),n("2532"),n("159b"),n("ddb0");function o(e){return e.length<2?e[0]||[]:[].reduce.call(e,(function(e,t){var n=[];return e.forEach((function(e){t.forEach((function(t){var o=[].concat(Array.isArray(e)?e:[e]);o.push(t),n.push(o)}))})),n}))}function r(e){return _.keys(e).filter((function(e){return e.includes("spec_")})).map((function(t){return e[t]})).join()}function i(e,t){var n;for(n in t)e[n]=e[n]&&"[object Object]"===e[n].toString()?i(e[n],t[n]):e[n]=t[n];return e}},ed54:function(e,t,n){}}]);